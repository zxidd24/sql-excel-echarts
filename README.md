# SQL转Excel转换器，前端预览及编辑，数据可视化

一个功能强大的Web应用程序，可以将SQL文件中的INSERT语句数据转换为Excel格式，并在前端实时预览转换结果。支持大数据量处理、虚拟滚动渲染、数据可视化等功能。

## 🚀 功能特性

### 核心功能
- **SQL数据解析**: 智能解析SQL文件中的INSERT语句，完整提取所有数据行
- **Excel转换**: 将SQL数据转换为标准Excel格式，支持多工作表
- **实时预览**: 在前端界面中直接查看转换后的Excel表格
- **文件管理**: 支持拖拽上传和选择现有SQL文件
- **数据下载**: 一键下载生成的Excel文件

### 高级功能
- **大数据处理**: 采用虚拟滚动技术，支持百万级数据的高性能渲染
- **表格交互**: 支持列宽拖拽调整、全局行高设置
- **Excel预览**: 选择已有Excel文件进行预览
- **数据可视化**: 集成Echarts图表库，支持地图等可视化展示
- **响应式设计**: 现代化UI界面，适配各种设备

## 📦 安装和运行

### 环境要求
- Node.js 14.0+
- npm 6.0+

### 1. 安装依赖

```bash
npm install
```

### 2. 启动服务器

```bash
# 生产模式
npm start

# 开发模式（自动重启）
npm run dev
```

### 3. 访问应用

打开浏览器访问：`http://localhost:3000`

## 🎯 使用方法

### 方法一：上传SQL文件
1. 将包含INSERT语句的SQL文件拖拽到上传区域，或点击"选择文件"按钮
2. 系统会自动解析SQL文件并转换为Excel格式
3. 转换完成后可以在前端预览Excel表格
4. 点击"下载Excel文件"按钮下载生成的Excel文件

### 方法二：转换现有文件
1. 将SQL文件放在项目的`database`文件夹中
2. 页面会自动显示可用的SQL文件列表
3. 点击对应文件的"转换"按钮进行转换

### 方法三：预览Excel文件
1. 将Excel文件放在`public/excel`目录中
2. 在页面下拉框中选择要预览的Excel文件
3. 点击"预览"按钮查看文件内容

### 数据可视化
1. 点击页面头部的"可视化"按钮
2. 系统会显示Echarts地图展示区域
3. 可以查看数据的地理分布等信息

## 📁 项目结构

```
Project_B/
├── database/              # SQL文件存储目录
│   ├── pt_pro_tenders.sql
│   └── sys_article.sql
├── public/               # 前端静态文件
│   ├── index.html        # 主页面
│   ├── script.js         # 前端JavaScript
│   └── excel/            # 生成的Excel文件存储目录
├── uploads/              # 临时上传文件目录
├── Echarts/              # Echarts可视化组件
│   ├── index.html        # 可视化页面
│   ├── main.js           # 可视化逻辑
│   └── Data/             # 可视化数据
├── server.js             # Express服务器主文件
├── test_parser.js        # SQL解析测试文件
├── package.json          # 项目配置
└── README.md             # 项目说明
```

## 🔧 API接口

### 获取SQL文件列表
```
GET /api/sql-files
```
返回database目录下的所有SQL文件列表

### 上传并转换SQL文件
```
POST /api/upload-and-convert
Content-Type: multipart/form-data
```
上传SQL文件并立即转换为Excel格式

### 转换现有SQL文件
```
POST /api/convert-sql-to-excel
Content-Type: application/json
Body: { "filePath": "文件路径" }
```
转换指定路径的SQL文件

### 获取Excel数据
```
GET /api/excel-data/:filename
```
获取指定Excel文件的数据用于前端预览

### 获取Excel文件列表
```
GET /api/excel-files
```
返回public/excel目录下的所有Excel文件列表

### 获取Excel文件内容
```
GET /api/excel-content/:filename
```
获取指定Excel文件的详细内容

## 🛠 技术栈

### 后端技术
- **Node.js**: 服务器运行环境
- **Express**: Web框架
- **Multer**: 文件上传处理
- **XLSX**: Excel文件读写
- **fs-extra**: 文件系统操作
- **CORS**: 跨域请求处理

### 前端技术
- **HTML5**: 页面结构
- **CSS3**: 样式设计
- **JavaScript**: 交互逻辑
- **Bootstrap 5**: UI组件库
- **Font Awesome**: 图标库
- **Echarts**: 数据可视化

### 核心算法
- **正则表达式**: SQL语句解析
- **虚拟滚动**: 大数据量渲染优化
- **绝对定位**: 表格布局控制

## 📊 支持的SQL格式

程序专门支持解析包含以下内容的SQL文件：
- **INSERT语句**: 完整的数据插入语句
- **多行数据**: 支持批量INSERT语句
- **数据类型**: 自动识别各种SQL数据类型
- **字符编码**: 支持UTF-8编码

### 解析特性
- 使用全局正则匹配确保完整提取所有INSERT语句
- 自动处理SQL注释和格式问题
- 支持复杂的SQL语句结构

## 🎨 界面特性

### 表格功能
- **虚拟滚动**: 高性能渲染大数据量表格
- **列宽调整**: 支持拖拽调整列宽
- **行高设置**: 全局行高自定义
- **严格对齐**: 表头与单元格完美对齐
- **边框样式**: 清晰的单元格边框

### 交互体验
- **拖拽上传**: 支持文件拖拽到指定区域
- **实时预览**: 转换结果即时显示
- **响应式设计**: 适配各种屏幕尺寸
- **加载状态**: 友好的加载提示

## ⚠️ 注意事项

1. **文件格式**: 确保SQL文件包含有效的INSERT语句
2. **文件大小**: 大文件转换可能需要较长时间
3. **内存使用**: 大数据量处理会占用较多内存
4. **文件存储**: 生成的Excel文件保存在`public/excel`目录中
5. **临时文件**: 上传的临时文件会自动清理

## 🔧 开发说明

### 添加新的数据类型支持

在`server.js`中的数据处理逻辑中添加新的类型处理：

```javascript
// 在数据解析部分添加新的类型处理
if (columnType.includes('your_new_type')) {
    // 处理新数据类型的逻辑
}
```

### 自定义样式

修改`public/index.html`中的CSS样式来自定义界面外观：

```css
/* 自定义表格样式 */
.custom-table {
    /* 你的样式定义 */
}
```

### 扩展可视化功能

在`Echarts/main.js`中添加新的图表类型：

```javascript
// 添加新的图表配置
const newChartOption = {
    // 图表配置
};
```

## 🐛 故障排除

### 常见问题

1. **数据解析不完整**
   - 检查SQL文件格式是否正确
   - 确认INSERT语句语法完整

2. **表格显示异常**
   - 刷新页面重新加载
   - 检查浏览器控制台错误信息

3. **文件上传失败**
   - 确认文件大小在限制范围内
   - 检查文件格式是否正确

4. **虚拟滚动问题**
   - 调整行高设置
   - 检查数据量是否过大

## 📈 性能优化

- **虚拟滚动**: 只渲染可见区域的数据行
- **懒加载**: 按需加载数据内容
- **内存管理**: 及时清理临时数据
- **缓存策略**: 缓存已解析的文件数据


## 📞 支持
- 开发者：张哲溪

如有问题或建议，请通过以下方式联系：
- 提交GitHub Issue
- 发送邮件至项目维护者：z1124340034@sina.com